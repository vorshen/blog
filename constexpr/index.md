# constexpr

## constexpr åŸºç¡€ç±»å‹
æ€»ç»“ä¸€ä¸‹å…³äº C++ ä¸­çš„ constexpr  
è¿™ä¸ªå­—é¢ä¸Šçœ‹åº”è¯¥ç¿»è¯‘ä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼ŒC++ Primer ä¹¦ä¸­ç»™å¸¸é‡è¡¨è¾¾å¼çš„å®šä¹‰æ˜¯:  
ã€Œå€¼ä¸ä¼šæ”¹å˜å¹¶ä¸”åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°±èƒ½å¾—åˆ°è®¡ç®—ç»“æœçš„è¡¨è¾¾å¼ã€  
```
const int max_files = 20; // âœ…
const int limit = max_files + 1; // âœ…
int staff_size = 27; // âŒ å€¼å¯èƒ½ä¼šæ”¹å˜
const int sz = get_size(); // âŒ æ— æ³•åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­å°±å¾—åˆ°è®¡ç®—ç»“æœ
```
é’ˆå¯¹åé¢ä¸¤ç§æƒ…å†µï¼Œå¦‚æœæˆ‘ä»¬å¢åŠ  constexpr ä¼šæœ‰ä»€ä¹ˆæ ·çš„æ•ˆæœå‘¢ï¼Ÿ  
å…ˆçœ‹åœºæ™¯3
```
int main(int argc, char* argv[]) {
    constexpr int staff_size = 27;
    printf("%d\n", staff_size);

    return 0;
}
```
å¹¶æ²¡æœ‰æŠ¥é”™ï¼Œå› ä¸ºè¿™é‡Œæ˜¾æ€§å°† staff_size å£°æ˜ä¸ºå¸¸é‡è¡¨è¾¾å¼ï¼Œstaff_size ä¹Ÿè‡ªå¸¦äº† const å±æ€§  

å†çœ‹åœºæ™¯4  
```
int get_size() {
    return 233;
}

int main(int argc, char* argv[]) {
    constexpr const int sz = get_size();
    printf("%d\n", sz);

    return 0;
}
```
ç¼–è¯‘æŠ¥é”™äº†ï¼Œå¦‚ä¸‹å›¾  
![](./assets/1.png)  
è¯´ get_size ä¸æ˜¯ä¸€ä¸ª constexpr å‡½æ•°ã€‚è™½ç„¶æˆ‘ä»¬è‚‰çœ¼çœ‹å¯ä»¥æ˜ç¡®çŸ¥é“ get_size ä¸€å®šæ˜¯è¿”å›ä¸€ä¸ªå­—é¢é‡ï¼Œå¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µå°±ç¡®å®šç»“æœï¼Œä½†æ˜¯ç¼–è¯‘å™¨æ— æ³•ä¿è¯ï¼Œæ­¤æ—¶å°±éœ€è¦æˆ‘ä»¬**ç»™ get_size å¢åŠ ä¸€ä¸ª constexpr ä¿®é¥°ç¬¦ã€‚**
```
constexpr int get_size() {
    return 233;
}
```
å¦‚ä¸Šå°±å¯ä»¥äº†  

## constexpr å‡½æ•°
é‚£å“ªäº›å‡½æ•°å¯ä»¥å¢åŠ  constexpr ä¿®é¥°ç¬¦å‘¢ï¼Ÿ  
1. æ— é€»è¾‘ï¼Œç›´æ¥è¿”å›å¸¸é‡è¡¨è¾¾å¼çš„
2. å¸¸é‡è¡¨è¾¾å¼è¿›è¡Œäº†ä¸€äº›æ“ä½œ
3. è™½ç„¶å‡½æ•°å†…éƒ¨æ˜¯å˜é‡ï¼Œä½†æ˜¯åªæœ‰å¸¸é‡è¡¨è¾¾å¼è°ƒç”¨çš„  
1ï¼Œ2å¾ˆå¥½ç†è§£ï¼Œpassï¼Œé‡ç‚¹çœ‹ä¸€ä¸‹3ï¼Œå¦‚ä¸‹ä»£ç   
```
constexpr int func(int t) {
    return t * t;
}

int main(int argc, char* argv[]) {
    printf("%d\n", func(2));
    printf("%d\n", func(argc));

    constexpr int a = func(2);
    constexpr int b = func(argc); // â—ç¼–è¯‘æŠ¥é”™
    int i = 5;
    constexpr int c = func(i); // â—ç¼–è¯‘æŠ¥é”™ï¼Œå¦‚æœä¸Šä¸€è¡Œæ˜¯ const int i = 5 åˆ™æ²¡é—®é¢˜

    return 0;
}
```
æŠ¥é”™è¡¨æ˜äº†å£°æ˜äº† constexpr çš„å‡½æ•°ï¼Œå®ƒçš„å‚æ•°å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œ**å“ªæ€•å‚æ•°å¹¶æ²¡æœ‰ç”¨åˆ°**ï¼Œæ¯”å¦‚å¦‚ä¸‹:  
```
constexpr int func(int t) {
    return 2;
}
```
è¿™ä¸ªå‡½æ•°æ²¡æœ‰ç”¨åˆ°å‚æ•°ï¼Œä½†æ˜¯è°ƒç”¨çš„åœ°æ–¹ï¼Œå‚æ•°ä¹Ÿå¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼  

## constexpr ç±»
ä¸Šä¸€èŠ‚æˆ‘ä»¬çŸ¥é“äº† constexpr å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼éƒ½å¿…é¡»æ˜¯å¸¸é‡è¡¨è¾¾å¼ï¼Œé‚£ä¸€å®šå¾—æ˜¯åŸºç¡€ç±»å‹ä¹ˆï¼Ÿå¯ä¸å¯ä»¥æ˜¯ class å‘¢ï¼Ÿæˆ‘ä»¬ç”¨å¦‚ä¸‹ä»£ç æ¥è¯•ä¸€ä¸‹  
```
#include <stdio.h>

class Yori1 {
public:
private:
    int t = 10;
};

class Yori2 {
public:
    Yori2(int t): t(t) {}
private:
    int t;
};

constexpr int func1(Yori1 y) {
    return 2;
}

constexpr int func2(Yori2 y) {
    return 3;
}

int main(int argc, char* argv[]) {
    constexpr int a = func1(Yori1());
    constexpr int b = func2(Yori2(3));
    return 0;
}
```
ä¸‹é¢æ˜¯ç¼–è¯‘ç»“æœ  
![](./assets/2.png)  
å¯ä»¥çœ‹åˆ° Yori1 è¢«è®¤ä¸ºæ˜¯ä¸€ä¸ª constexprï¼Œè™½ç„¶å®ƒå…¨ç¨‹æ²¡æœ‰ constexpr å…³é”®å­—ã€‚ä¹Ÿèƒ½ç†è§£ï¼Œæ¯•ç«Ÿå®ƒå®Œå…¨æ˜¯ä¸€ä¸ªæ•°æ®ç±»ã€‚  
Yori2 å°±ä¸è¡Œäº†ï¼Œå‡ºç°äº†æŠ¥é”™ã€‚å…¶å®æ ¸å¿ƒåœ¨äº Yori2 çš„æ„é€ å‡½æ•°å¹¶ä¸ç®—æ˜¯ä¸€ä¸ª constexpr å‡½æ•°ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç»™æ„é€ å‡½æ•°åŠ ä¸Š constexpr å…³é”®å­—å³å¯ï¼Œå¦‚ä¸‹:  
```
class Yori2 {
public:
    constexpr Yori2(int t): t(t) {}
private:
    int t;
};
```
è¿™æ ·åªè¦åˆå§‹åŒ– Yori2 çš„æ—¶å€™ï¼Œä¼ å…¥çš„æ„é€ å‡½æ•°å‚æ•°æœ¬èº«æ˜¯ä¸€ä¸ªå¸¸é‡è¡¨è¾¾å¼ï¼Œç”Ÿæˆçš„å®ä¾‹ï¼Œä¹Ÿå¯ä»¥å½“ä½œå¸¸é‡è¡¨è¾¾å¼ï¼ŒğŸ›«ï¸  