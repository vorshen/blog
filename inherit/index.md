# inherit
ç»§æ‰¿åŸºæœ¬æ˜¯å¤§éƒ¨åˆ†è¯­è¨€éƒ½æœ‰çš„ç‰¹æ€§ï¼Œè¿™æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­æ‰€å¿…é¡»çš„ã€‚é¢å‘å¯¹è±¡è¿™ä¸€ç¼–ç¨‹èŒƒå¼ä¹Ÿå—åˆ°å¹¿å¤§å¼€å‘çš„å–œçˆ±ï¼Œç©¶å…¶ç‰¹ç‚¹æ˜¯ï¼Œé¢å‘å¯¹è±¡æœ‰ç€æŠ½è±¡ç°å®åŒ–çš„ç‰¹ç‚¹ï¼Œç”¨ä¸€ä¸ªä¸ªå¯¹è±¡çš„å±æ€§ã€æ–¹æ³•æ¥æè¿°å‡ºå¤æ‚çš„ç¨‹åºå…³ç³»ï¼Œå¹¶ä¸”æ–¹ä¾¿æŠ½è±¡å¤ç”¨ï¼Œæ˜“äºæ‰©å±•ã€‚  
è¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°±ç®€å•çš„æ¥èŠèŠé¢å‘å¯¹è±¡ä¸­çš„ç»§æ‰¿ç‰¹ç‚¹ï¼Œä¸»è¦æ˜¯ä¸€äº›æ€»ç»“å’Œè‡ªå·±çš„æ€è€ƒã€‚

*è¯­è¨€ä¸»è¦ä¸º C++ï¼Œä¸­é€”ä¸€äº›ä¸¾ä¾‹å¯èƒ½ä¼šç”¨åˆ° JS*ã€‚

# å‰è¨€
ç»§æ‰¿åœ¨é¢å‘å¯¹è±¡ä¸­é‡è¦ä¸é‡è¦ï¼Ÿ  
å½“ç„¶é‡è¦ï¼Œè¿™é‡Œç½‘ä¸Šæœä¸€æœå°±æœ‰ä¸€å¤§å †ä¼˜ç‚¹ã€‚ä½†æ˜¯æˆ‘ä»¬å¯èƒ½è¿˜èƒ½çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¨€è®º:  
>>> ä½¿ç”¨ç»§æ‰¿æ˜¯ç¨‹åºå‘˜å…¥é—¨çš„æ ‡å¿—ã€‚
>>> ä¸ä½¿ç”¨ç»§æ‰¿æ˜¯ç¨‹åºå‘˜æˆç†Ÿçš„æ ‡å¿—ã€‚

è¿™ä¸ªè¯´æ³•è¿˜æ˜¯æœ‰ä¸€å®šé“ç†çš„ï¼Œç»§æ‰¿çš„é—®é¢˜åœ¨äºå¤ªé‡äº†ï¼Œä¸€æ—¦å»ºç«‹äº†ç»§æ‰¿å…³ç³»ï¼Œéšä¹‹è€Œæ¥çš„ä¾¿æ˜¯é€ƒè„±ä¸æ‰çš„ä¾èµ–ï¼Œæ–°åŠŸèƒ½ä¸€æ—¦å‘ç°æŸäº›åœºæ™¯ä¸‹ç»§æ‰¿å…³ç³»å¼‚å¸¸ï¼Œè¦ä¹ˆæ¨å€’é‡æ¥ï¼Œè¦ä¹ˆæ·¹æ²¡åœ¨èŒ«èŒ«ä¸­çš„å…¼å®¹å¤„ç†ã€‚  
æ›´æœ‰æŸäº›è¯­è¨€ï¼ˆæ¯”å¦‚ javascriptï¼‰ä¸æ”¯æŒå¤šç»§æ‰¿ï¼Œå¦‚æœéšä¾¿ä½¿ç”¨äº†ç»§æ‰¿è¿™ä¸€é‡æ­¦å™¨ï¼Œå…¶ä»–è¯¥ä½¿ç”¨ç»§æ‰¿çš„åœ°æ–¹å°±ä¼šå˜å¾—æ— æ¯”è‰°éš¾ã€‚

é‚£ä¹ˆæ˜¯ä¸æ˜¯å°±ä¸€å®šä¸è¦ä½¿ç”¨ç»§æ‰¿å‘¢ï¼Ÿé‚£ä¹Ÿä¸å¯èƒ½ï¼Œå¦åˆ™è¿™ä¸€ç‰¹æ€§å°±ä¸ä¼šå­˜åœ¨å¦‚æ­¤ä¹‹ä¹…ï¼Œå­˜åœ¨ä¾¿æœ‰å…¶å­˜åœ¨çš„ç†ç”±ã€‚  
æˆ‘ä»¬è¦åšåˆ°çš„æ˜¯: **åˆç†çš„ä½¿ç”¨ç»§æ‰¿**ã€‚

å¦‚ä½•åˆç†çš„ä½¿ç”¨å‘¢ï¼Ÿæˆ‘ä»¬ä»ä¸‹é¢ä¸€äº›ç»§æ‰¿çš„ç‰¹æ€§è¯´èµ·ã€‚

# public/protected/private
æ³¨æ„ï¼Œè¿™é‡Œè¦è¯´çš„å¹¶ä¸æ˜¯åŸºç±»æ–¹æ³•çš„ä¿®é¥°ç¬¦ï¼ˆpublic å¯ä»¥å¤–ç•Œè°ƒç”¨ï¼Œprotected åªèƒ½è‡ªå·±å’Œæ´¾ç”Ÿç±»è°ƒç”¨ï¼Œprivate åªèƒ½è‡ªå·±è°ƒç”¨ï¼‰ã€‚ä¸‰ä¸ªæ–¹æ³•ä¿®é¥°ç¬¦å®åœ¨æ˜¯å¤ªç®€å•äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥çœç•¥ã€‚

**ä¸ºäº†æ–¹ä¾¿åŒºåˆ†ï¼Œä¸‹é¢å¦‚æœæ˜¯ç»§æ‰¿è¯­ä¹‰ä¸‹ï¼Œpublicã€protectedã€private ç»§ç»­ä½¿ç”¨è‹±æ–‡**ã€‚  
**æˆå‘˜ã€æ–¹æ³•ä¸­ publicã€protectedã€private ä½¿ç”¨ä¸­æ–‡ï¼šå…¬æœ‰ã€ä¿æŠ¤ã€ç§æœ‰**ã€‚

## public
public ç»§æ‰¿çš„ç‰¹ç‚¹å°±æ˜¯:  
- å…¬æœ‰æˆå‘˜ã€æ–¹æ³•ï¼Œç»§ç»­ä¿æŒä¸ºå…¬æœ‰ã€‚
- ä¿æŠ¤æˆå‘˜ã€æ–¹æ³•ï¼Œç»§ç»­ä¿æŒä¸ºä¿æŠ¤ã€‚
- ç§æœ‰æˆå‘˜ã€æ–¹æ³•ï¼Œç»§ç»­ä¿æŒä¸ºç§æœ‰ã€‚

public ç»§æ‰¿åº”è¯¥æ˜¯ä½¿ç”¨æœ€å¤šçš„ä¸€ç§ç»§æ‰¿æ¨¡å¼äº†ï¼Œè¿™å¯èƒ½ä¹Ÿæ˜¯å¤§å®¶è®¤çŸ¥ä¸­æœ€æ ‡å‡†çš„å¯¹åº”**ç»§æ‰¿**è¿™ä¸€åæ¬¡çš„ä½¿ç”¨ã€‚  
æŒ‰ã€ŠEffective C++ã€‹ä¸­çš„è¯´æ³•ï¼Œpublic ç»§æ‰¿æ˜¯ä¸€ç§ is-a çš„æè¿°ã€‚  
*class D : public B*  
è¿™æ„å‘³ç€ D æ˜¯ B çš„ä¸€ç§ç‰¹ä¾‹ã€‚Bæ›´é€šç”¨åŒ–ï¼Œè€ŒDæ›´ç‰¹æ®ŠåŒ–ã€‚

ä¸¾ä¾‹å¯ä»¥å¦‚ä¸‹:
```
class Shape {
public:
    COLOR color;

    virtual ~Shape() = default;
    virtual void draw() = 0;
};

class Rect : public Shape {
public:
    void draw() {
        // ...
    }
};
```
Shape æ˜¯ä¸€ç§é€šç”¨åŒ–çš„å›¾å½¢æŠ½è±¡æè¿°ï¼Œå£°æ˜äº† drawæ–¹æ³•ï¼ˆ*å›¾å½¢éƒ½æ‹¥æœ‰ draw æ–¹æ³•ï¼Œè¿™æ— å¯åšé*ï¼‰ï¼Œè€Œ Rect æ˜¯ç‰¹æ®ŠåŒ–çš„å›¾å½¢ï¼Œæˆ‘ä»¬éœ€è¦ç»™å®ƒå®šä¹‰å®ƒè‡ªå·±çš„ draw æ–¹æ³•ã€‚  
è®¤çŸ¥æ¸…æ™°ï¼Œæ˜¯ä¸€ç§ is-a çš„å…³ç³»ï¼›æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™ã€‚å¯ä»¥åˆæ­¥è¯´è¿™æ˜¯ä¸€ç§è¾ƒå¥½çš„ç»§æ‰¿ä½¿ç”¨ã€‚

å†çœ‹ä¸¤ç§ä¸åˆé€‚çš„ä¾‹å­:
1. çŸ©å½¢ä¸æ­£æ–¹å½¢
```
class Rect {
public:
    virtual ~Rect() = default;

    virtual void setWidth() {};
    virtual void setHeight() {};
    virtual int getWidth() {};
    virtual int getHeight() {};
};

class Square : public Rect {
public:
    void setWidth() {};
    void setHeight() {};
    int getWidth() {};
    int getHeight() {};
};
```
åœ¨æˆ‘ä»¬ç°å®ç”Ÿæ´»ä¸­çš„è®¤çŸ¥é‡Œï¼Œæ­£æ–¹å½¢æ˜¯ä¸€ç§ç‰¹æ®Šçš„çŸ©å½¢ï¼Œä»¥ä¸Šæˆ‘ä»¬å°†è®¤çŸ¥è½¬æ¢ä¸ºäº†ä»£ç ã€‚  
ä½†è¿™ç§ç»§æ‰¿å…³ç³»çœŸçš„èƒ½æ»¡è¶³é‡Œæ°æ›¿æ¢åŸåˆ™ä¹ˆï¼Ÿ  
*ä»»ä½•ä½¿ç”¨çŸ©å½¢çš„åœ°æ–¹ï¼Œéƒ½å¯ä»¥ç”¨æ­£æ–¹å½¢ä»£æ›¿å—ï¼Ÿ*  
**æ˜æ˜¾æ˜¯ä¸å¯ä»¥çš„**ã€‚

2. äº‹ä»¶
```
// node å®˜æ–¹ demo
const EventEmitter = require('events');

class MyEmitter extends EventEmitter {};

const myEmitter = new MyEmitter();
myEmitter.on('event', () => {
  console.log('an event occurred!');
});
myEmitter.emit('event');

// ä¸æ¨èå†™æ³•
class Rect extends EventEmitter {
    draw() {
        // balabala...
        this.emit('draw');
    }
};

const rect = new Rect();
rect.on('draw', function() {
    // ...
});
```
è¿™é‡Œç”¨äº†äº‹ä»¶ä¸¾ä¾‹ï¼Œè¿™ç§é€šç”¨äº‹ä»¶çš„æ–¹å¼ä¸€èˆ¬æœ‰ä¸ªåŸºç±»ï¼Œæä¾›äº†ç›‘å¬ã€æ´¾å‘çš„æ–¹æ³•ã€‚æ­¤æ—¶å¦‚æœå·æ‡’ï¼Œå¯ä»¥è®©è‡ªå·±çš„ class ç»§æ‰¿è¿™ä¸ªäº‹ä»¶åŸºç±»ï¼Œç”¨èµ·æ¥ä¹Ÿæ²¡æ¯›ç—…ï¼Œè¿˜æŒºæ–¹ä¾¿ã€‚  
ä½†æ˜¯æˆ‘ä»¬æ”¾ç©ºå¤§è„‘æ€è€ƒä¸€ä¸‹ï¼Œ**çŸ©å½¢**å’Œ**äº‹ä»¶**è¿™ä¸¤è€…æ˜¯ç»§æ‰¿å…³ç³»å—ï¼Ÿ**çŸ©å½¢**æ˜¯ä¸€ç§ç‰¹æ®ŠåŒ–çš„**äº‹ä»¶**å—ï¼Ÿç¨‹åºä¸­ä»»ä½•**äº‹ä»¶**è¯­ä¹‰çš„åœ°æ–¹ï¼Œæ›¿æ¢ä¸º**çŸ©å½¢**ï¼Œè¿˜æ­£å¸¸å—ï¼Ÿ  
ç”±æ­¤å¯çŸ¥ï¼Œè¿™å¹¶ä¸æ˜¯ä¸€ç§ is-a çš„è¯­ä¹‰ï¼Œå¹¶ä¸æ¨èç”¨ç»§æ‰¿çš„å…³ç³»ã€‚

## protected
protected ç»§æ‰¿çš„ç‰¹ç‚¹å°±æ˜¯:  
- å…¬æœ‰æˆå‘˜ã€æ–¹æ³•ï¼Œå˜ä¸ºä¿æŠ¤ã€‚
- ä¿æŠ¤æˆå‘˜ã€æ–¹æ³•ï¼Œç»§ç»­ä¿æŒä¸ºä¿æŠ¤ã€‚
- ç§æœ‰æˆå‘˜ã€æ–¹æ³•ï¼Œç»§ç»­ä¿æŒä¸ºç§æœ‰ã€‚

protected çš„è¯ï¼ŒæŒ‰ã€ŠEffective C++ã€‹çš„ä¸­è¯´æ³•ï¼Œæ˜¯ä¸€ç§æ²¡å•¥æ„ä¹‰çš„ç»§æ‰¿æ–¹å¼ã€‚  
u1s1ï¼Œç¡®å®ã€‚

## private
private ç»§æ‰¿çš„ç‰¹ç‚¹å°±æ˜¯:
- å…¬æœ‰æˆå‘˜ã€æ–¹æ³•ï¼Œå˜ä¸ºç§æœ‰ã€‚
- ä¿æŠ¤æˆå‘˜ã€æ–¹æ³•ï¼Œå˜ä¸ºç§æœ‰ã€‚
- ç§æœ‰æˆå‘˜ã€æ–¹æ³•ï¼Œç»§ç»­ä¿æŒä¸ºç§æœ‰ã€‚

private ä¸åƒ protectedï¼Œå®ƒè¿˜æ˜¯æœ‰æ„ä¹‰çš„ã€‚å®ƒçš„ä¸€ä¸ªæ ¸å¿ƒæ˜¯å°†çˆ¶ç±»çš„å…¬å…±æ–¹æ³•ä¸å¯¹å¤–æš´éœ²ï¼Œå†…éƒ¨ä½¿ç”¨ã€‚

æŒ‰ã€ŠEffective C++ã€‹ä¸­æ ‡å‡†è¯´æ³•ï¼Œè¿™æ˜¯ä¸€ç§ is-implemented-in-terms of çš„è¯­ä¹‰ã€‚å…‰è®²æœ‰ç‚¹è™šï¼Œæˆ‘ä»¬ä¸¾ä¸ªğŸŒ°ï¼Œç”¨ä¹¦ä¸­ Set å’Œé“¾è¡¨çš„æƒ…å†µæ¥è¯´ã€‚  
å¦‚æœæˆ‘ä»¬ä¸å¸Œæœ›ä½¿ç”¨æ ‡å‡†åº“ä¸­çš„ Setï¼ˆå¹³è¡¡æ ‘å®ç°ï¼‰ï¼Œè€Œæ˜¯å…ˆç”¨é“¾è¡¨å®ç°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯èƒ½æœ‰å¦‚ä¸‹çš„å†™æ³•:  
```
template<typename T>
class Set : public std::list<T> {
public:
    void insert(const T& elem) {
        std::list<T>::push_back(elem);
    }

    int size() {
        return std::list<T>::size();
    }
};

int main(int argc, char* argv[]) {
    Set<int> t;
    t.insert(3);
    t.insert(3);
    printf("size: %d\n", t.size());
    return 0;
}

// è¾“å‡ºç»“æœ:  
size: 2
```
é€šè¿‡ç»“æœå¯ä»¥çœ‹å‡ºè¿™é‡Œçš„è®¾è®¡æ˜¯æœ‰é—®é¢˜çš„ï¼ŒSet åº”è¯¥å«æœ‰å»é‡ã€‚  
æŸäº›åŒå­¦å¯èƒ½æŒ‡å‡ºå¢åŠ å…¼å®¹çš„æ–¹æ¡ˆï¼Œæ¯”å¦‚åœ¨ insert é‡Œé¢å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨ï¼Œå†å†³å®šè°ƒç”¨åŸºç±»çš„ push_back æˆ–è€…ç›´æ¥ returnã€‚**ä½†å¦‚æœä½¿ç”¨è€…ç›´æ¥è°ƒç”¨ push_back æ¥å£å‘¢ï¼Ÿ**   
æŸäº›åŒå­¦å¯èƒ½è·³å‡ºå®ç°æœ¬èº«ï¼Œä»å®è§‚å±‚é¢å¼€å§‹è€ƒè™‘ï¼Œè¿™é‡ŒçœŸçš„æ˜¯ is-a çš„è¯­ä¹‰ä¹ˆï¼Ÿåœ¨ç¨‹åºä¸­æˆ‘ä»¬å°†æ‰€æœ‰ list çš„åœ°æ–¹æ›¿æ¢æˆ Setï¼Œè¯­ä¹‰ä¸Šå…¶å®æ˜¯æœ‰å·®å¼‚çš„ï¼Œç”±æ­¤å¯çŸ¥è¿™å¹¶ä¸åº”è¯¥æ˜¯ç»§æ‰¿çš„å…³ç³»ã€‚

é‚£æ˜¯ä»€ä¹ˆï¼Ÿ  
is-implemented-in-terms ofï¼Œ**Set æ˜¯ç”± list å®ç°çš„**ã€‚æ‰€ä»¥è§„èŒƒè¯­ä¹‰çš„å†™æ³•ï¼Œå¯ä»¥æ˜¯è¿™æ ·:  
```
template<typename T>
class Set : private std::list<T> { // âš ï¸ private ç»§æ‰¿
public:
    void insert(const T& elem) {
        // ç›¸åº”å»é‡å¤„ç†
        std::list<T>::push_back(elem);
    }

    int size() {
        return std::list<T>::size();
    }
};
```
*è¿™é‡Œæ˜¯ä½¿ç”¨äº† private ç»§æ‰¿çš„æ–¹æ¡ˆï¼Œå…³äºç»„åˆå’Œ private ç»§æ‰¿çš„é€‰æ‹©ï¼Œåé¢ä¼šæœ‰ä¸€ä¸ªå°ç»“ä¸“é—¨æåˆ°ã€‚*  

# non-virtual/prue-virtual/impure-virtual
è¿™ä¸€èŠ‚æ˜¯é’ˆå¯¹åŸºç±»ä¸‰ç§å…³äº virtual çš„ä¸åŒç”¨æ³•ã€‚

## non-virtual
æ„å‘³ç€æ²¡æœ‰ virtual å…³é”®å­—ï¼Œè¿™ç§ç»™å‡ºçš„è¦æ±‚æ˜¯:  
**æ´¾ç”Ÿç±»ä¸è¦è¿›è¡Œä»»ä½• overrideã€‚**  
ç›¸æ¯”è¾ƒ Javascript æˆ‘ä»¬åšä¸ªå¯¹æ¯”:  
```
// C++
class Base {
public:
    void say() {
        printf("Base\n");
    }
};

class Derived : public Base {
public:
    void say() {
        printf("Derived\n");
    }
};

void run(Base* obj) {
    obj->say();
}

int main(int argc, char* argv[]) {
    Derived d;
    run(&d);
    return 0;
}

// è¾“å‡º Base
```
```
// Javascript
class Base {
    say() {
        console.log('Base');
    }
}

class Derived extends Base {
    say() {
        console.log('Derived');
    }
}

function run(obj) {
    obj.say();
}

const derived = new Derived();
run(derived);

// è¾“å‡º Derived
```
ç»“æœä¸Šçœ‹åˆ°ï¼Œè™½ç„¶çœŸå®çš„å¯¹è±¡éƒ½æ˜¯æ´¾ç”Ÿç±»å®ä¾‹ï¼Œä½†æ˜¯ C++ è¾“å‡ºæ˜¯ Baseï¼Œè€Œ Javascript è¾“å‡ºæ˜¯ Derivedã€‚  
å¯¼è‡´å·®å¼‚çš„æœ¬è´¨æ˜¯å› ä¸º C++ æ˜¯ç¼–è¯‘å™¨å†³å®šäº† non-virtual å‡½æ•°çš„è°ƒç”¨ thisï¼Œè€Œ Js æ— æ³•åœ¨ç¼–è¯‘å™¨åšåˆ°ï¼Œåªæœ‰åœ¨è¿è¡Œæ—¶é€šè¿‡åŸå‹é“¾æŸ¥æ‰¾ã€‚

è¿™æ„å‘³ç€æ— æ³•æ»¡è¶³å¤šæ€çš„è¯‰æ±‚ï¼Œè¿˜ä¼šå¼•èµ·æœªçŸ¥çš„ bugï¼Œæ‰€ä»¥ä»æ ¹æºè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå°±æ˜¯ä¸è¦è¦†å†™åŸºç±»çš„ non-virtual æ–¹æ³•ã€‚

## pure-virtual
ç›¸æ¯”è¾ƒ non-virtualï¼Œpure-virtual å°±æ˜¯å¦ä¸€ä¸ªæç«¯ï¼Œå®ƒè¦æ±‚å­ç±»å¿…é¡»å®ç°å¯¹åº”çš„æ–¹æ³•ã€‚  
```
class Base {
public:
    virtual void say() = 0;
};

class Derived : public Base {

};

int main(int argc, char* argv[]) {
    Derived d;
    return 0;
}

// ç¼–è¯‘æŠ¥é”™å¦‚ä¸‹
./test.cc: In function â€˜int main(int, char**)â€™:
./test.cc:13:13: error: cannot declare variable â€˜dâ€™ to be of abstract type â€˜Derivedâ€™
     Derived d;
             ^
./test.cc:8:7: note:   because the following virtual functions are pure within â€˜Derivedâ€™:
 class Derived : public Base {
       ^~~~~~~
./test.cc:5:18: note:      â€˜virtual void Base::say()â€™
     virtual void say() = 0;
```
åŸå› ä¹Ÿè¯´çš„å¾ˆæ¸…æ¥šäº†: **because the following virtual functions are pure within â€˜Derivedâ€™**ã€‚

*ä¸è¿‡å¾ˆéªšçš„æ˜¯ï¼Œä¸€ä¸ª pure-virtual æ–¹æ³•ï¼ŒåŸºç±»æ˜¯å…è®¸æœ‰å…·ä½“å®ç°çš„ï¼Œå¯ä»¥çœ‹ä½œä¸€ç§é»˜è®¤å®ç°ã€‚ä¸ä¸‹é¢è¯´çš„ impure-virtual ä¸åŒï¼Œä½¿ç”¨ pure-virtual çš„é»˜è®¤å®ç°ï¼Œç›¸å½“äºä¸€ç§å¼ºåˆ¶æŒ‡å®šã€‚*

## impure-virtual
ç†è§£äº† pure-virtualï¼Œimpure-virtual å…¶å®éƒ½ä¸ç”¨å¤šè¯´ä»€ä¹ˆäº†ã€‚  

æ€»ç»“ä¸€ä¸‹ä¸‰ç§
- non-virtual å¼ºåˆ¶ç»§æ‰¿å®ç°
- pure-virtual å¼ºåˆ¶ç»§æ‰¿æ¥å£
- impure-virtual ç»§æ‰¿å®ç°å’Œæ¥å£

# virtual ç»§æ‰¿
è¿™ä¸€èŠ‚ç¨å¾®å¤æ‚ä¸€äº›ï¼Œæˆ‘ä»¬è¿™é‡Œåªç®€å•çš„è¯´ä¸€ä¸‹ï¼Œåç»­ä¼šè¡¥ä¸€ç¯‡ä¸“é—¨è¯´ virtual çš„æ–‡ç« ã€‚  
ä¹‹å‰æˆ‘ä»¬åˆ—ä¸¾çš„ä¾‹å­é‚£äº›éƒ½æ˜¯ non-virtual ç»§æ‰¿ã€‚

æƒ³è¦ç†è§£ virtual ç»§æ‰¿å’Œ non-virtual ç»§æ‰¿çš„åŒºåˆ«ï¼Œæˆ‘ä»¬å…ˆä» **virtual** è¿™ä¸ªå…³é”®å­—å¼€å§‹ã€‚  
ç»§æ‰¿ï¼ˆis-a è¯­ä¹‰ï¼‰çš„æ ¸å¿ƒæ˜¯å¤šæ€ï¼Œè€Œæ— è®ºæ˜¯ virtual æ–¹æ³•ï¼Œè¿˜æ˜¯ virtual ç»§æ‰¿éƒ½æ˜¯åœ¨ä¸ºå¤šæ€æœåŠ¡ã€‚  
æ‰€ä»¥å°±åƒä¹¦ä¸Šè¯´çš„ï¼Œpublic ç»§æ‰¿ï¼Œå…¶å®æ›´åº”è¯¥æŒ‡æ˜æ˜¯ virtual public ç»§æ‰¿ã€‚  
é‚£ä¸ºä»€ä¹ˆæˆ‘ä»¬æ²¡æœ‰è¿™æ ·åšå‘¢ï¼Œä¸»è¦è¿˜æ˜¯ä¸ºæ€§èƒ½è€ƒè™‘ï¼Œåé¢ä¼šä¸“é—¨è¯´ã€‚

å¯¹äº virtual ç»§æ‰¿çš„å»ºè®®å°±æ˜¯ï¼Œå°½é‡ä¸è¦ä½¿ç”¨ virtual ç»§æ‰¿ï¼Œé™¤éä½ å¾ˆæ˜ç¡®å¾ˆæ˜ç¡®ä½ å°±éœ€è¦å®ƒã€‚

# ç»§æ‰¿ä¸ç»„åˆ
è¿™é‡Œæä¸€ä¸‹ç»§æ‰¿å’Œç»„åˆçš„åŒºåˆ«ï¼Œæˆ‘ä»¬åˆ—ä¸€ä¸ªå›¾:  
![./assets/1.png](./assets/1.png)  
ä¸€èˆ¬æ¥è¯´ has-a çš„è¯­ä¹‰å¤§å®¶éƒ½ä¸ä¼šå¼„é”™çš„ï¼Œå› ä¸ºåœ¨åº”ç”¨å±‚å¤ªé ä¸Šäº†ï¼Œæ¯”å¦‚  
**åˆ©åˆ©æœ‰ä¸€ç“¶é…’**ï¼Œè¿™é‡Œå®åœ¨æ— æ³•èƒ½è”æƒ³åˆ°åˆ©åˆ©å’Œé…’æ˜¯æ€æ ·ç»§æ‰¿çš„å…³ç³»ã€‚  

é‚£å¯¹äºå®ç°å±‚æ¥è¯´ï¼Œå¯èƒ½å°±ä¸æ˜¯é‚£ä¹ˆå¥½åŒºåˆ†äº†ï¼Œæ­¤æ—¶æˆ‘ä»¬çš„é€‰æ‹©ç­–ç•¥ä¹Ÿå¾ˆç®€å•:  
**ä¸€åˆ‡èƒ½ç”¨ç»„åˆçš„ï¼Œéƒ½ä¼˜å…ˆä½¿ç”¨ç»„åˆã€‚**  
æŸäº›ç‰¹æ®Šåœºæ™¯ï¼Œæ¯”å¦‚éœ€è¦ä½¿ç”¨åŸºç±»çš„ protectedï¼Œæ¯”å¦‚éœ€è¦å¤å†™ virtual æ–¹æ³•ç­‰ï¼Œä¸‹é¢ä¸¾ä¸ªğŸŒ°:  
```
class ObjectSizeCounter : private HeapVisitor<ObjectSizeCounter> {
  friend class HeapVisitor<ObjectSizeCounter>;

 public:
  size_t GetSize(RawHeap* heap) {
    Traverse(heap);
    return accumulated_size_;
  }

 private:
  static size_t ObjectSize(const HeapObjectHeader* header) {
    const size_t size =
        header->IsLargeObject()
            ? static_cast<const LargePage*>(BasePage::FromPayload(header))
                  ->PayloadSize()
            : header->GetSize();
    DCHECK_GE(size, sizeof(HeapObjectHeader));
    return size - sizeof(HeapObjectHeader);
  }

  // âš ï¸ override åŸºç±» 
  bool VisitHeapObjectHeader(HeapObjectHeader* header) {
    if (header->IsFree()) return true;
    accumulated_size_ += ObjectSize(header);
    return true;
  }

  size_t accumulated_size_ = 0;
};

```
è¿™æ˜¯ v8 çš„æºç ä¸­ä¸€ä¸ªç±»ï¼Œç”¨æ¥ç»Ÿè®¡å¯¹è±¡çš„å¤§å°ã€‚å®ƒ private ç»§æ‰¿äº†ä¸€ä¸ª **HeapVisitor** ç±»ï¼Œè¿™ä¸ªç±»æœ‰ç‚¹é•¿å°±ä¸è´´äº†ï¼ŒHeapVisitor ç±»çš„ä½œç”¨æ˜¯éå† heap ç©ºé—´ã€‚  
is-implemented-in-terms of è¯­ä¹‰è¿™é‡Œä¸è¿‡å¤šè§£é‡Šäº†ï¼Œè¿™é‡Œä¹‹æ‰€ä»¥ä½¿ç”¨äº† private è€Œéç»„åˆï¼Œæ˜¯å› ä¸ºå¿…é¡»è¦å¤å†™ VisitHeapObjectHeader æ–¹æ³•ï¼Œä»¥æ­¤æ¥å®ç°è®¡æ•°çš„ä½œç”¨ã€‚
